<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ¿ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: 'PingFang SC', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .success { border-color: #10b981; background: #f0fdf4; }
        .error { border-color: #ef4444; background: #fef2f2; }
        .info { border-color: #3b82f6; background: #eff6ff; }
        pre {
            background: #f8fafc;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ¨¡æ¿ä¿®å¤æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section info">
        <h2>æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•ä¿®å¤åçš„æ¨¡æ¿åŠ è½½å’Œæ–‡æœ¬æ›¿æ¢åŠŸèƒ½ã€‚</p>
        <p><strong>é—®é¢˜æè¿°ï¼š</strong>ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å’Œç”Ÿæˆçš„HTMLç»“æœä¸åŒ¹é…ï¼Œæ€€ç–‘è¾“å…¥å†…å®¹å’Œæç¤ºè¯æ²¡æœ‰è¢«æ­£ç¡®è°ƒç”¨ã€‚</p>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•æ­¥éª¤</h2>
        <button onclick="testTemplateLoading()">1. æµ‹è¯•æ¨¡æ¿åŠ è½½</button>
        <button onclick="testTextReplacement()">2. æµ‹è¯•æ–‡æœ¬æ›¿æ¢</button>
        <button onclick="testFullWorkflow()">3. æµ‹è¯•å®Œæ•´æµç¨‹</button>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æ‰‹åŠ¨æµ‹è¯•</h2>
        <p>è¯·åœ¨ä¸»åº”ç”¨ä¸­è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š</p>
        <ol>
            <li>è¾“å…¥æµ‹è¯•æ–‡æœ¬ï¼š"è‹¹æœé”€é‡100ä¸ªï¼Œé¦™è•‰é”€é‡80ä¸ªï¼Œæ©™å­é”€é‡60ä¸ª"</li>
            <li>é€‰æ‹©"æ•°æ®åˆ†æå›¾è¡¨"æ¨¡æ¿</li>
            <li>ç‚¹å‡»ç”Ÿæˆ</li>
            <li>æ£€æŸ¥ç”Ÿæˆçš„ç»“æœæ˜¯å¦åŒ…å«è¾“å…¥çš„å…·ä½“æ•°æ®</li>
        </ol>
        <a href="/" target="_blank" style="display: inline-block; margin-top: 10px; padding: 10px 20px; background: #10b981; color: white; text-decoration: none; border-radius: 6px;">æ‰“å¼€ä¸»åº”ç”¨æµ‹è¯•</a>
    </div>

    <script type="module">
        import { MarkdownPromptLoader } from './src/services/MarkdownPromptLoader.js';
        import { TemplateSelector } from './src/components/TemplateSelector.js';

        window.testTemplateLoading = async function() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>ğŸ”„ æ­£åœ¨æµ‹è¯•æ¨¡æ¿åŠ è½½...</h3>';
            
            try {
                const loader = new MarkdownPromptLoader();
                const templates = await loader.getAvailableTemplates();
                
                let html = '<div class="test-section success"><h3>âœ… æ¨¡æ¿åŠ è½½æˆåŠŸ</h3>';
                html += `<p>æ‰¾åˆ° ${templates.length} ä¸ªæ¨¡æ¿ï¼š</p><ul>`;
                
                for (const template of templates) {
                    html += `<li><strong>${template.name}</strong> (${template.filename})</li>`;
                }
                
                html += '</ul></div>';
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="test-section error"><h3>âŒ æ¨¡æ¿åŠ è½½å¤±è´¥</h3><pre>${error.message}</pre></div>`;
            }
        };

        window.testTextReplacement = async function() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>ğŸ”„ æ­£åœ¨æµ‹è¯•æ–‡æœ¬æ›¿æ¢...</h3>';
            
            try {
                const loader = new MarkdownPromptLoader();
                const template = await loader.loadTemplate('æ•°æ®åˆ†æå›¾è¡¨.md');
                
                const testText = 'è‹¹æœé”€é‡100ä¸ªï¼Œé¦™è•‰é”€é‡80ä¸ªï¼Œæ©™å­é”€é‡60ä¸ª';
                const prompt = template.template.replace(/\{text\}/g, testText);
                
                let html = '<div class="test-section success"><h3>âœ… æ–‡æœ¬æ›¿æ¢æˆåŠŸ</h3>';
                html += '<h4>åŸå§‹æ¨¡æ¿ï¼š</h4>';
                html += `<pre>${template.template.substring(0, 200)}...</pre>`;
                html += '<h4>æ›¿æ¢åçš„æç¤ºè¯ï¼š</h4>';
                html += `<pre>${prompt.substring(0, 300)}...</pre>`;
                html += `<p><strong>æ£€æŸ¥ï¼š</strong>æç¤ºè¯ä¸­${prompt.includes(testText) ? 'âœ… åŒ…å«' : 'âŒ ä¸åŒ…å«'}æµ‹è¯•æ–‡æœ¬</p>`;
                html += '</div>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="test-section error"><h3>âŒ æ–‡æœ¬æ›¿æ¢å¤±è´¥</h3><pre>${error.message}</pre></div>`;
            }
        };

        window.testFullWorkflow = async function() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>ğŸ”„ æ­£åœ¨æµ‹è¯•å®Œæ•´æµç¨‹...</h3>';
            
            try {
                // æ¨¡æ‹Ÿå®Œæ•´çš„å·¥ä½œæµç¨‹
                const selector = new TemplateSelector();
                await selector.init();
                
                // æ¨¡æ‹Ÿé€‰æ‹©æ¨¡æ¿
                const templates = await selector.loader.getAvailableTemplates();
                if (templates.length > 0) {
                    const firstTemplate = await selector.loader.loadTemplate(templates[0].filename);
                    selector.currentTemplate = firstTemplate;
                    
                    const testText = 'è‹¹æœé”€é‡100ä¸ªï¼Œé¦™è•‰é”€é‡80ä¸ªï¼Œæ©™å­é”€é‡60ä¸ª';
                    const finalPrompt = selector.getPromptText(testText);
                    
                    let html = '<div class="test-section success"><h3>âœ… å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸ</h3>';
                    html += `<p><strong>é€‰æ‹©çš„æ¨¡æ¿ï¼š</strong>${firstTemplate.name}</p>`;
                    html += `<p><strong>æµ‹è¯•æ–‡æœ¬ï¼š</strong>${testText}</p>`;
                    html += '<h4>æœ€ç»ˆç”Ÿæˆçš„æç¤ºè¯ï¼š</h4>';
                    html += `<pre>${finalPrompt.substring(0, 400)}...</pre>`;
                    html += `<p><strong>éªŒè¯ï¼š</strong>æœ€ç»ˆæç¤ºè¯ä¸­${finalPrompt.includes(testText) ? 'âœ… åŒ…å«' : 'âŒ ä¸åŒ…å«'}ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬</p>`;
                    html += '</div>';
                    
                    resultsDiv.innerHTML = html;
                } else {
                    throw new Error('æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„æ¨¡æ¿');
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="test-section error"><h3>âŒ å®Œæ•´æµç¨‹æµ‹è¯•å¤±è´¥</h3><pre>${error.message}\n${error.stack}</pre></div>`;
            }
        };
    </script>
</body>
</html>